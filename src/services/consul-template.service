#!/bin/bash
source /etc/envvars

for TEMPLATE in /etc/consul-templates/*.tmpl.go;
do
  FILE_NAME=`echo $TEMPLATE | sed -e 's/\(.*\)\(.tmpl.go\)/\1/'`
  exec consul-template \
  -consul=${CONSUL_ADDRESS}:${CONSUL_PORT} \
  -template "/etc/consul-templates/$TEMPLATE:/etc/nginx/conf.d/$FILE_NAME:sv hup nginx"
done